<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何优化webpack配置 | webpack4+vue配置教程</title>
    <meta name="description" content="使用webpack4配置一个类vue脚手架的配置">
    
    
    <link rel="preload" href="/WebpackLearnOfVue-site/assets/css/0.styles.8fc1bed0.css" as="style"><link rel="preload" href="/WebpackLearnOfVue-site/assets/js/app.e5c486a2.js" as="script"><link rel="preload" href="/WebpackLearnOfVue-site/assets/js/2.cf78363d.js" as="script"><link rel="preload" href="/WebpackLearnOfVue-site/assets/js/5.19edb173.js" as="script"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/10.ecca8d64.js"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/11.89e63402.js"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/3.2bfea351.js"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/4.973d1eab.js"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/6.6e81a3b8.js"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/7.e380188c.js"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/8.0d8bf668.js"><link rel="prefetch" href="/WebpackLearnOfVue-site/assets/js/9.55ee98de.js">
    <link rel="stylesheet" href="/WebpackLearnOfVue-site/assets/css/0.styles.8fc1bed0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/WebpackLearnOfVue-site/" class="home-link router-link-active"><!----> <span class="site-name">webpack4+vue配置教程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/WebpackLearnOfVue-site/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/umbrella22/WebpackLearnOfVue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/WebpackLearnOfVue-site/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/umbrella22/WebpackLearnOfVue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>简介</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/WebpackLearnOfVue-site/Overview/" class="sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/WebpackLearnOfVue-site/Overview/basis/" class="sidebar-link">使用webpack搭一个最简单的demo</a></li><li><a href="/WebpackLearnOfVue-site/Overview/basis/CommonTools.html" class="sidebar-link">webpack常用的工具</a></li><li><a href="/WebpackLearnOfVue-site/Overview/basis/WithVue.html" class="sidebar-link">结合vue配置一个环境分离的配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/WebpackLearnOfVue-site/Overview/advanced/" class="active sidebar-link">如何优化webpack配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WebpackLearnOfVue-site/Overview/advanced/#关于部分css类的loader的优化方案" class="sidebar-link">关于部分css类的loader的优化方案</a></li><li class="sidebar-sub-header"><a href="/WebpackLearnOfVue-site/Overview/advanced/#当依赖库十分庞大时，使用dll功能解决dev缓慢的问题" class="sidebar-link">当依赖库十分庞大时，使用dll功能解决dev缓慢的问题</a></li><li class="sidebar-sub-header"><a href="/WebpackLearnOfVue-site/Overview/advanced/#使用hard-source-webpack-plugin解决dev缓慢问题" class="sidebar-link">使用hard-source-webpack-plugin解决dev缓慢问题</a></li><li class="sidebar-sub-header"><a href="/WebpackLearnOfVue-site/Overview/advanced/#关于cdn加速的一些建议" class="sidebar-link">关于cdn加速的一些建议</a></li><li class="sidebar-sub-header"><a href="/WebpackLearnOfVue-site/Overview/advanced/#关于启用gzip" class="sidebar-link">关于启用gzip</a></li><li class="sidebar-sub-header"><a href="/WebpackLearnOfVue-site/Overview/advanced/#关于控制台的友好化输出" class="sidebar-link">关于控制台的友好化输出</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何优化webpack配置"><a href="#如何优化webpack配置" aria-hidden="true" class="header-anchor">#</a> 如何优化webpack配置</h1> <blockquote><p>想了很久，在之前的webpack教程中，也仅仅只是教了大家，如何使用webapck4手撸一份vue可用的配置，但是在我的实际工作中，会遇到很多需要优化的地方，例如：cdn加速， gzip等这些操作，再加上，原本的那一份教程，在css和css预处理器的操作上，有很多的不足和细微的问题。现在一点点的捋出来，希望能够帮到大家。</p></blockquote> <ul><li>首先就是关于css和css预处理器的设置上，由于当时时间问题，很草率地就直接自己写上了，问题是没有问题，但是相比vue-cli2生成的那个配置，我还是有很多的不足，现在我就在vue-cli2的基础上，对其进行修改，接上篇的配置信息，我们还需要在utlis.js中添加对css的处理代码如下</li></ul> <h2 id="关于部分css类的loader的优化方案"><a href="#关于部分css类的loader的优化方案" aria-hidden="true" class="header-anchor">#</a> 关于部分css类的loader的优化方案</h2> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 将css类loader放到这里一并处理，不再写在dev和prod中了</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">cssLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">const</span> cssLoader <span class="token operator">=</span> <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> postcssLoader <span class="token operator">=</span> <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 这里就是生成loader和其对应的配置</span>
    <span class="token keyword">function</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token parameter">loader<span class="token punctuation">,</span> loaderOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> loaders <span class="token operator">=</span> options<span class="token punctuation">.</span>usePostCSS <span class="token operator">?</span> <span class="token punctuation">[</span>cssLoader<span class="token punctuation">,</span> postcssLoader<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>cssLoader<span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            loaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> loader <span class="token operator">+</span> <span class="token string">'-loader'</span><span class="token punctuation">,</span>
                options<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> loaderOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 当配置信息中开启此项时，启用css分离压缩</span>
        <span class="token comment">// 这一项在生产环境时，是默认开启的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>extract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>MiniCssPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>loaders<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果不开启则让vue-style-loader来处理</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'vue-style-loader'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>loaders<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// https://vue-loader.vuejs.org/en/configurations/extract-css.html</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        css<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        postcss<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        less<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        sass<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> indentedSyntax<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        scss<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        stylus<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'stylus'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        styl<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'stylus'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 根据上面的函数遍历出来的各个css预处理器的loader进行最后的拼装</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">styleLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> loaders <span class="token operator">=</span> exports<span class="token punctuation">.</span><span class="token function">cssLoaders</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> extension <span class="token keyword">in</span> loaders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> loader <span class="token operator">=</span> loaders<span class="token punctuation">[</span>extension<span class="token punctuation">]</span>
        output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            test<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'\\.'</span> <span class="token operator">+</span> extension <span class="token operator">+</span> <span class="token string">'$'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            use<span class="token punctuation">:</span> loader
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> output
<span class="token punctuation">}</span>
</code></pre></div><ul><li>完整的utils.js呢，我也放上来吧，以免有的朋友不大知道这段代码该加在什么位置</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> packageConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span>
<span class="token comment">// 这里为什么要引入这个呢，由于webpack4的原因，需要用到这个插件的loader</span>
<span class="token keyword">const</span> MiniCssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将资源文件合并到config文件中的配置项中</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">assetsPath</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> assetsSubDirectory <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>
        <span class="token operator">?</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsSubDirectory
        <span class="token punctuation">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsSubDirectory

    <span class="token keyword">return</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>assetsSubDirectory<span class="token punctuation">,</span> _path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 将css类loader放到这里一并处理，不再写在dev和prod中了</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">cssLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">const</span> cssLoader <span class="token operator">=</span> <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> postcssLoader <span class="token operator">=</span> <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 这里就是生成loader和其对应的配置</span>
    <span class="token keyword">function</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token parameter">loader<span class="token punctuation">,</span> loaderOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> loaders <span class="token operator">=</span> options<span class="token punctuation">.</span>usePostCSS <span class="token operator">?</span> <span class="token punctuation">[</span>cssLoader<span class="token punctuation">,</span> postcssLoader<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>cssLoader<span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            loaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> loader <span class="token operator">+</span> <span class="token string">'-loader'</span><span class="token punctuation">,</span>
                options<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> loaderOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 当配置信息中开启此项时，启用css分离压缩</span>
        <span class="token comment">// 这一项在生产环境时，是默认开启的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>extract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>MiniCssPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>loaders<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'vue-style-loader'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>loaders<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// https://vue-loader.vuejs.org/en/configurations/extract-css.html</span>
    <span class="token comment">// 返回对应的loader</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        css<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        postcss<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        less<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        sass<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> indentedSyntax<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        scss<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        stylus<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'stylus'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        styl<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'stylus'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 根据上面的函数遍历出来的各个css预处理器的loader进行最后的拼装</span>
<span class="token comment">// 这里的options就是在调用的时候向内传递一些loader的配置信息，比如map文件等</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">styleLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> loaders <span class="token operator">=</span> exports<span class="token punctuation">.</span><span class="token function">cssLoaders</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> extension <span class="token keyword">in</span> loaders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> loader <span class="token operator">=</span> loaders<span class="token punctuation">[</span>extension<span class="token punctuation">]</span>
        output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            test<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'\\.'</span> <span class="token operator">+</span> extension <span class="token operator">+</span> <span class="token string">'$'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            use<span class="token punctuation">:</span> loader
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> output
<span class="token punctuation">}</span>
<span class="token comment">// 当出现报错时，弹出系统弹窗告知出现错误</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">createNotifierCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-notifier'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">severity<span class="token punctuation">,</span> errors</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>severity <span class="token operator">!==</span> <span class="token string">'error'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

        <span class="token keyword">const</span> error <span class="token operator">=</span> errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> filename <span class="token operator">=</span> error<span class="token punctuation">.</span>file <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 这里是设置当出现错误时，给你的，标题，错误信息，错误文件地址，以及图标</span>
        notifier<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> packageConfig<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            message<span class="token punctuation">:</span> severity <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            subtitle<span class="token punctuation">:</span> filename <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
            icon<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'logo.png'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取本地局域网ip</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">getNetworkIp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> needHost <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 打开的host</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获得网络接口列表</span>
        <span class="token keyword">let</span> network <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">networkInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> dev <span class="token keyword">in</span> network<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> iface <span class="token operator">=</span> network<span class="token punctuation">[</span>dev<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iface<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> alias <span class="token operator">=</span> iface<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>alias<span class="token punctuation">.</span>family <span class="token operator">===</span> <span class="token string">'IPv4'</span> <span class="token operator">&amp;&amp;</span> alias<span class="token punctuation">.</span>address <span class="token operator">!==</span> <span class="token string">'127.0.0.1'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>alias<span class="token punctuation">.</span>internal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    needHost <span class="token operator">=</span> alias<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        needHost <span class="token operator">=</span> <span class="token string">'localhost'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> needHost<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>然后我们需要在原webpack.dev.js和webpack.prod.js中去修改我们之前的rules：</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>    <span class="token comment">//  开发环境下</span>
    <span class="token operator">...</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token punctuation">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>devtool<span class="token punctuation">,</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将之前的rules数组直接替换成下面的样子</span>
        rules<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">styleLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sourceMap<span class="token punctuation">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>cssSourceMap<span class="token punctuation">,</span> usePostCSS<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
    <span class="token comment">// 生产环境下</span>
    mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    devtool<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionSourceMap <span class="token operator">?</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>devtool <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将之前的rules数组直接替换成下面的样子</span>
        rules<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">styleLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 是否开启css的map映射</span>
            sourceMap<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionSourceMap<span class="token punctuation">,</span>
            <span class="token comment">// 该选项是是否开启css分离压缩的选项</span>
            extract<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">// 是否使用postcss-loader添加浏览器前缀</span>
            usePostCSS<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsRoot<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
</code></pre></div><ul><li>好啦，大家应该就很清楚了，在这里我们使用了<code>utlis</code>中的<code>styleLoaders</code>函数，由上面的代码我们就就可以知道，该函数接收至多三个对象 <code>sourceMap</code>，<code>extract</code>，<code>usePostCSS</code>；他们均是一个布尔值，从左到右分别表示，是否打开css的map文件，是否开启css抽取压缩，是否为一些css样式添加浏览器前缀。至此，我们就可以彻底的放心大胆的使用市面上已有的css预处理器，因为在<code>utlis</code>中的<code>cssLoaders</code>函数中，我们看到，它会返回你设置好的所有的预处理器loader，这样我们就不用再两个webpack文件中都要去设置，只需要当出了新的css预处理器的时候，加到这里就好了。</li></ul> <h2 id="当依赖库十分庞大时，使用dll功能解决dev缓慢的问题"><a href="#当依赖库十分庞大时，使用dll功能解决dev缓慢的问题" aria-hidden="true" class="header-anchor">#</a> 当依赖库十分庞大时，使用dll功能解决dev缓慢的问题</h2> <blockquote><p>很多时候，项目的依赖非常的多，这就导致了每次更改之后热更新需要等很久的时候，那么此时，我们就需要使用dll来解决这个问题了，当然，和win上的dll文件是有很大的区别的，我们需要使用的是 webpack自带的 <code>DllPlugin</code>插件，现在附上我的代码:</p></blockquote> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackbar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpackbar'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里就是添加</span>
        vendor<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'axios'</span><span class="token punctuation">,</span> <span class="token string">'element-ui'</span><span class="token punctuation">,</span> <span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'vue-router'</span><span class="token punctuation">,</span> <span class="token string">'echarts'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        library<span class="token punctuation">:</span> <span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//clean dist</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>
            path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">,</span> <span class="token string">'[name].manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">webpackbar</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">&quot;抽取依赖中&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p> <p>此时你需要在index.development.html中引入这个输出的dll文件才算真的完成了dll化操作。</p> <p>但是在webpack4中其实这个优化已经无所谓了，因为webpack4已经做了很多优化，这就让dll化并不能达到预期效果。</p></div> <ul><li>然后我们在package.json中添加脚本 <code>&quot;dll&quot;:&quot;webpack --config webpack.vendor.js&quot;</code>在每次添加了大型依赖之前可以将其加入vendor数组内，并且执行 <code>npm run dll</code>，这样每次编译的时候，就不会带上那些大型依赖，也就不会导致每次更改一个字编译都要等很久的囧场景了~</li></ul> <h2 id="使用hard-source-webpack-plugin解决dev缓慢问题"><a href="#使用hard-source-webpack-plugin解决dev缓慢问题" aria-hidden="true" class="header-anchor">#</a> 使用hard-source-webpack-plugin解决dev缓慢问题</h2> <p>在dll化开始疲软之后，hard-source-webpack-plugin插件走入了大家的视野中，为模块提供中间缓存步骤。为了查看结果，您需要使用此插件运行webpack两次：第一次构建将花费正常的时间。第二次构建将显着加快（大概提升90%的构建速度）该插件已经被webpack5纳入默认优化方案中了，而在webpack4中我们也同样可以享受到这90%的加速！</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev hard-source-webpack-plugin 或 <span class="token function">yarn</span> <span class="token function">add</span> --dev hard-source-webpack-plugin
</code></pre></div><p>然后我们在webpack.base.js中引入并添加插件即可！</p> <div class="warning custom-block"><p class="custom-block-title">提示</p> <p>在当前例子中，我已经默认添加该插件，所以大家可以不用重复操作哦。</p></div> <h2 id="关于cdn加速的一些建议"><a href="#关于cdn加速的一些建议" aria-hidden="true" class="header-anchor">#</a> 关于cdn加速的一些建议</h2> <blockquote><p>随着需求越来越多，各种依赖库也越来越多，如果是跨平台应用还好，资源加载都在本地，不需要用户从我们服务器下载，但是，线上的站怎么办，我们的服务器带宽有限，压根就没法顾及这些，此时，cdn会给我们一些帮助，使用cdn可以将我们的一些依赖放在他们的服务器中分发，好处不言而喻，在去除了依赖库的情况下，我们的代码再加上进行了压缩，分包等一系列处理，不仅仅只是缩短了首屏启动的时间，那么现在来贴代码：</p></blockquote> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在原打包分析下添加或者除配置对象中的任意位置</span>
<span class="token comment">// 这里有涉及到config文件夹中index文件的build对象</span>
<span class="token comment">// 那么我们肯定也要在config文件中做对应的设置了</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>cdn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处是从config中读取NeedCdnModuleName</span>
    options<span class="token punctuation">.</span>externals <span class="token operator">=</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>NeedCdnModuleName
    <span class="token comment">// 这里按需加载了一个依赖，所以，您需要安装它</span>
    <span class="token keyword">const</span> WebpackCdnPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-cdn-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebpackCdnPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        modules<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>NeedCdnModuleAddress
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>关于config文件夹中index文件的内容则是在其build对象下新添代码</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>build<span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token comment">// 此处配置可使用插件自动配置需要cdn加速的模块</span>
        <span class="token comment">// 你可能需要执行 npm i webpack-cdn-plugin -D 命令来安装这个依赖</span>
        cdn<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// 需要说明的是，这个里，用于配置需要被webpack忽略的依赖包名</span>
        <span class="token comment">// 左边是npm安装时的名字，而右边则是该包对全局暴漏的名字</span>
        <span class="token comment">// 如果不知道全局名称怎么办，</span>
        <span class="token comment">// 详情配置请参考：https://webpack.docschina.org/configuration/externals/</span>
        <span class="token comment">// 该插件默认走的是https://unpkg.com cdn服务器</span>
        NeedCdnModuleName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            vue<span class="token punctuation">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span>
            <span class="token string">'vue-router'</span><span class="token punctuation">:</span> <span class="token string">'VueRouter'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 这里则是被webpack忽略之后，加载cdn</span>
        <span class="token comment">// name表示该模块在npm中的命名，var表示该模块全局变量名称，应当和上面右侧设置一致</span>
        <span class="token comment">// path则代表是该模块在unpkg中的文件路径，如果不清楚清去该站点自行查询。</span>
        <span class="token comment">// 详情配置请参考：https://www.npmjs.com/package/webpack-cdn-plugin</span>
        NeedCdnModuleAddress<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
            <span class="token keyword">var</span><span class="token punctuation">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span>
            path<span class="token punctuation">:</span> <span class="token string">'dist/vue.runtime.min.js'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'vue-router'</span><span class="token punctuation">,</span>
            <span class="token keyword">var</span><span class="token punctuation">:</span> <span class="token string">'VueRouter'</span><span class="token punctuation">,</span>
            path<span class="token punctuation">:</span> <span class="token string">'dist/vue-router.min.js'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>这里需要提一下，在vue中，当你在main中引入了依赖库的css时，如果你没有判断就直接使用import的话，css则部分时没有加入cdn的，这里需要注意一下，在demo中，我会追加跟多本文中额外的信息，毕竟很多东西只看文章还是太抽象，结合代码学习，是最快的。</p></blockquote> <h2 id="关于启用gzip"><a href="#关于启用gzip" aria-hidden="true" class="header-anchor">#</a> 关于启用gzip</h2> <blockquote><p>有时候，我们即使使用了cdn加速，剔除了所有的依赖，但是我们站本身的代码就非常的庞大，分包之后依旧还有100k以上的大小时，（可能你们会说100k没什么嘛，可以忽略了，那么这个就可以忽略查看）我们可以启用gzip，将我们的代码放到压缩包中在传到用户计算机上时，由浏览器解压执行；此时我们需要使用 <code>compression-webpack-plugin</code>，该插件支持三种压缩算法 <code>brotliCompress</code> 和 <code>gzip</code> 还有 <code>zopfli</code> 至于哪种更好，就不在本文的阐述范围内了，上代码：</p></blockquote> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 您可以选择添加在cdn下面</span>
<span class="token comment">// 当config中对应项为true时,启用gzip功能</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>gzip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> CompressionPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 这里如果算法为brotliCompress的话,需要将gz改为br</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[path].gz[query]'</span><span class="token punctuation">,</span>
        <span class="token comment">// 压缩算法,这里的话,你可以选择brotliCompress和gzip还有zopfli,当然这一切要取决于用户的浏览器支持哪种压缩模式</span>
        <span class="token comment">// 若要使用brotliCompress算法,需要nodejs11.7以上.并且后缀名为.br</span>
        algorithm<span class="token punctuation">:</span> <span class="token string">'gzip'</span><span class="token punctuation">,</span>
        <span class="token comment">// 根据config文件设置的情况对什么文件进行压缩</span>
        test<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
            <span class="token string">'\\.('</span> <span class="token operator">+</span>
            config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionGzipExtensions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">')$'</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 超过该大小就会压缩(单位:字节)</span>
        threshold<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
        <span class="token comment">// 压缩比,官方给的解释设置0.8是最佳了.至于计算公式,就是minRatio = 压缩后的大小 / 原来的大小</span>
        <span class="token comment">// 当压缩比比这个低的话,就会进行压缩处理,如果设置成1的话,就是全部都处理了.</span>
        minRatio<span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
        <span class="token comment">// 是否删除原文件(默认也是false)</span>
        <span class="token comment">// 这这里并不推荐删除源文件,因为需要照顾到不支持gzip的浏览器</span>
        deleteOriginalAssets<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>同样附上config中的代码</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 此处配置是是否使用gzip功能对代码进行高强度的压缩(值得注意的是gzip功能需要nginx做出对应的配置,谨慎开启)</span>
<span class="token comment">// 你可能需要执行 npm i compression-webpack-plugin -D 命令来安装这个依赖</span>
<span class="token comment">// 因为本包中可能会不带这项依赖，毕竟不是每个人都需要</span>
gzip<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token comment">// 这里设置需要被压缩的文件后缀默认是只压缩css和js</span>
productionGzipExtensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">]</span>
</code></pre></div><ul><li>这里，注释中也说明了，需要nginx或者您所知道您项目中所使用承载页面具备 <code>httpServer</code> 的服务器中去配置，开启gzip或是其他的压缩选项。</li></ul> <h2 id="关于控制台的友好化输出"><a href="#关于控制台的友好化输出" aria-hidden="true" class="header-anchor">#</a> 关于控制台的友好化输出</h2> <blockquote><p>在Nuxt中我发现其控制台的进度条不仅仅可以给开发者一个进度告知，并且还会显示当前正在加载什么，幸运的是，他们将这个插件开源了出来，废话不多说，开整！</p></blockquote> <ul><li>首先是安装该插件 <code>npm i webpackbar -D</code> 然后在我们的webpack公共配置中加入</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> webpackbar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpackbar'</span><span class="token punctuation">)</span>
<span class="token comment">/*这里是其他代码*/</span>
<span class="token comment">// 在插件数组中加入</span>
plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 该插件支持一个名称，可用于控制台输出</span>
        <span class="token keyword">new</span> <span class="token class-name">webpackbar</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>然后我们重启一次webpack，就看到对应的效果了。其实还有更多的webpack的操作台输出插件，但是它们在win上表现非常差，所以我就不再介绍~</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/WebpackLearnOfVue-site/Overview/basis/WithVue.html" class="prev">
          结合vue配置一个环境分离的配置
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/WebpackLearnOfVue-site/assets/js/app.e5c486a2.js" defer></script><script src="/WebpackLearnOfVue-site/assets/js/2.cf78363d.js" defer></script><script src="/WebpackLearnOfVue-site/assets/js/5.19edb173.js" defer></script>
  </body>
</html>
